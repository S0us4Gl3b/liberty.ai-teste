<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    
    <title>teste up</title>
</head>
<body>
    <h1>Escolha seu arquivo</h1>
    <input type="file" id="fileinput" accept="image/*">
    <img id="img" height=500px width=auto>
    <a href='./sobre.html'> botao de teste</a>
     
    <script>
        function upload(img) {
            const formData = new FormData()
            formData.append('image', img.files[0])

            try {
                fetch('http://localhost:3000/upload', {
                    method: 'POST',
                    body: formData
                })
            
                .then(response => response.json())
                .then(data => {
                    const imageId = data.imageId
                    console.log('ID: ', imageId) 
                    if (imageId) {
                        chama_pagina_edit(imageId)
                    }
                })

            } catch (error) {
                console.error('Erro:', error)
            }
        }

    function chama_pagina_edit(imageId) {
        console.log('Chamando outra pagina')
        sessionStorage.setItem('idDaImagem', imageId)
        window.location.href = 'sobre.html'
    }

    function teste() {
        try {
            fetch('http://localhost:3000/getimage', {
            method: 'GET'
            })
            .then(response => response.blob())  // Recebe a resposta como blob
            .then(blob => {
            // Cria uma URL temporária para o blob recebido
            const url = URL.createObjectURL(blob);

            // Seleciona o elemento img do HTML
            const img = document.getElementById('img');

            // Atribui a URL temporária ao src da imagem
            img.src = url;
            })
            .catch(error => {
            console.error('Erro ao carregar a imagem:', error);
            });
        } catch (error) {
            console.error('Erro inesperado:', error);
        }
    }

        // Event listener para o input de arquivo
        const img = document.getElementById('fileinput')
        img.addEventListener('change', function() {
            const file = img.files[0]
            if (file) {
                upload(img);
            }
        });
    </script>
</body>
</html>